# 快速幂运算

## 1. 快速幂运算的数学原理

### 1.1 基本定义

给定底数 $a$ 和指数 $n$，计算 $a^n$。最简单的算法，那就是n个a相乘，算法复杂度是 $O(n)$, 有没有更快的方法呢？快速幂算法大家一般都很熟悉，但是，我们就记住了算法，但是对一些细节我们不了解，下面我们详细分析一下这个算法, 这个算法分为四步：

1. **二进制分解**：$n = \sum_{i=0}^{k-1} b_i \cdot 2^i$
2. **幂运算分解**：$a^n = \prod_{i=0}^{k-1} (a^{2^i})^{b_i}$
3. **递推计算**：$x_{i+1} = x_i^2$ 其中 $x_i = a^{2^i}$
4. **条件累乘**：只在对应位为1时进行乘法

本质，把一个n个a 连乘的问题，转换为 $x_i$ 的连乘问题，复杂度从 $O(n)$ 降低为 $O(logn)$

### 1.2 二进制展开

将指数 $n$ 表示为二进制形式：

$$ n = \sum_{i=0}^{k-1} b_i \cdot 2^i $$

其中 $b_i \in \{0,1\}$ 是 $n$ 的第 $i$ 位二进制数，$k$ 是 $n$ 的二进制位数。

### 1.3 幂运算的分解

根据指数的二进制展开，可以将幂运算分解为：

$$ a^n = a^{\sum_{i=0}^{k-1} b_i \cdot 2^i} = \prod_{i=0}^{k-1} a^{b_i \cdot 2^i} = \prod_{i=0}^{k-1} (a^{2^i})^{b_i} $$

### 1.4 快速幂算法公式

设 $x_i = a^{2^i}$，则：

$$ a^n = \prod_{i=0}^{k-1} x_i^{b_i} $$

其中 $x_i$ 可以通过递推计算：

$$ x_0 = a $$

$$ x_{i+1} = x_i^2 $$

## 2. 算法步骤的数学表示

### 2.1 初始化

- $result = 1$ （任何数的0次方为1）
- $base = a$ （初始底数）

### 2.2 迭代过程

对于 $i = 0, 1, 2, \ldots, k-1$：

$$ result_{i+1} = \begin{cases}
result_i \cdot base_i & \text{if } b_i = 1 \\
result_i & \text{if } b_i = 0
\end{cases} $$

$$ base_{i+1} = base_i^2 $$

### 2.3 最终结果

$$ a^n = result_k $$

## 3. 具体示例的数学表示

以 $a = 2$, $n = 13$ 为例：

### 3.1 二进制展开

$$ 13 = 1 \cdot 2^0 + 0 \cdot 2^1 + 1 \cdot 2^2 + 1 \cdot 2^3 = 1101_2 $$

### 3.2 迭代过程

我们详细分析一下运算的过程，每个步骤最和上面公式对应起来

**第0步** ($i = 0$, $b_0 = 1$):

- $base_0 = 2$
- $result_1 = result_0 \cdot base_0 = 1 \cdot 2 = 2$
- $base_1 = base_0^2 = 2^2 = 4$

**第1步** ($i = 1$, $b_1 = 0$):

- $result_2 = result_1 = 2$ （因为 $b_1 = 0$）
- $base_2 = base_1^2 = 4^2 = 16$

**第2步** ($i = 2$, $b_2 = 1$):

- $result_3 = result_2 \cdot base_2 = 2 \cdot 16 = 32$
- $base_3 = base_2^2 = 16^2 = 256$

**第3步** ($i = 3$, $b_3 = 1$):

- $result_4 = result_3 \cdot base_3 = 32 \cdot 256 = 8192$
- $base_4 = base_3^2 = 256^2 = 65536$

### 3.3 验证

$$ 2^{13} = 8192 $$
